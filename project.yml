name: AppCoinsSDK
options:
  bundleIdPrefix: com.aptoide
  deploymentTarget:
    iOS: '14.0'
settings:
  base:
    SWIFT_VERSION: '5.5'
    CODE_SIGN_IDENTITY: Apple Distribution
    DEVELOPMENT_TEAM: 26RRGP4GNA
    CODE_SIGN_STYLE: Manual
    BUILD_LIBRARY_FOR_DISTRIBUTION: true
    SKIP_INSTALL: false
    SUPPORTED_PLATFORMS: iphonesimulator iphoneos
    TARGETED_DEVICE_FAMILY: 1,2
    LD_RUNPATH_SEARCH_PATHS: $(inherited) @executable_path/Frameworks @loader_path/Frameworks
    EMBEDDED_CONTENT_CONTAINS_SWIFT: true
    ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES: true
targets:
  AppCoinsSDK:
    type: framework
    platform: iOS
    sources:
    - Sources/AppCoinsSDK
    settings:
      base:
        INFOPLIST_FILE: Sources/AppCoinsSDK/Info.plist
        BUILD_LIBRARY_FOR_DISTRIBUTION: true
        SKIP_INSTALL: false
        SUPPORTED_PLATFORMS: iphonesimulator iphoneos
        TARGETED_DEVICE_FAMILY: 1,2
        LD_RUNPATH_SEARCH_PATHS: $(inherited) @executable_path/Frameworks @loader_path/Frameworks
        EMBEDDED_CONTENT_CONTAINS_SWIFT: true
        ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES: true
        CODE_SIGN_IDENTITY: Apple Distribution
        DEVELOPMENT_TEAM: 26RRGP4GNA
        CODE_SIGN_STYLE: Manual
    options:
      transitivelyLinkDependencies: false
    dependencies:
    - package: url-image
      product: URLImage
    - package: CryptoSwift
      product: CryptoSwift
    - package: web3swift
      product: web3swift
    - package: SkeletonUI
      product: SkeletonUI
    - package: SwiftyRSA
      product: SwiftyRSA
    - package: adyen-ios
      product: Adyen
    - package: adyen-ios
      product: AdyenCard
    - package: adyen-ios
      product: AdyenComponents
    - package: adyen-ios
      product: AdyenSession
    - package: ActivityIndicatorView
      product: ActivityIndicatorView
    - package: DeviceKit
      product: DeviceKit
    - framework: ./Sources/AppCoinsSDK/Frameworks/IndicativeLibrary.xcframework
      embed: true
    - framework: ./Sources/AppCoinsSDK/Frameworks/PPRiskMagnes.xcframework
      embed: true
    resources:
    - path: Sources/AppCoinsSDK/Localization
      explicit: true
    frameworks: []
    postBuildScripts:
    - name: Embed Frameworks
      script: "\n                            # Find .bundle files\n              \
        \              BUNDLE_FILES=$(find \"${BUILT_PRODUCTS_DIR}\" -maxdepth 1 -type\
        \ d -name \"*.bundle\")\n                            # Copy .bundle files\
        \ to inside the generated framework\n                            for BUNDLE\
        \ in $BUNDLE_FILES; do\n                                rsync -av --delete\
        \ \"${BUNDLE}\" \"${BUILT_PRODUCTS_DIR}/AppCoinsSDK.framework\"\n        \
        \                    done\n\n                            EMBED_FRAMEWORKS=()\n\
        \n                            # Find top-level frameworks\n              \
        \              FRAMEWORKS=$(find \"${BUILT_PRODUCTS_DIR}\" -maxdepth 1 -type\
        \ d -name \"*.framework\")\n                            for FRAMEWORK in $FRAMEWORKS;\
        \ do\n                                # Extract the framework name from the\
        \ full path\n                                FRAMEWORK_NAME=$(basename \"\
        $FRAMEWORK\")\n\n                                # Skip the AppCoinsSDK.framework\n\
        \                                if [ \"$FRAMEWORK_NAME\" = \"AppCoinsSDK.framework\"\
        \ ]; then\n                                    continue\n                \
        \                fi\n\n                                EMBED_FRAMEWORKS+=(\"\
        $FRAMEWORK\")\n                                echo \"Top-Level Framework:\
        \ ${FRAMEWORK}\"\n                            done\n\n                   \
        \         # Find package frameworks\n                            PACKAGE_FRAMEWORKS=$(find\
        \ \"${BUILT_PRODUCTS_DIR}/PackageFrameworks\" -maxdepth 1 -type d -name \"\
        *.framework\")\n                            for PACKAGE_FRAMEWORK in $PACKAGE_FRAMEWORKS;\
        \ do\n                                EMBED_FRAMEWORKS+=(\"$PACKAGE_FRAMEWORK\"\
        )\n                                echo \"Package Framework: ${PACKAGE_FRAMEWORK}\"\
        \n                            done\n\n                            FRAMEWORKS_DIR=\"\
        ${BUILT_PRODUCTS_DIR}/${FRAMEWORKS_FOLDER_PATH}\"\n                      \
        \      echo \"Frameworks directory: ${FRAMEWORKS_DIR}\"\n                \
        \            echo \"Embed Frameworks: ${EMBED_FRAMEWORKS}\"\n            \
        \                echo \"Build products dir: ${BUILT_PRODUCTS_DIR}\"\n    \
        \                        # Ensure the frameworks directory exists\n      \
        \                      mkdir -p \"${FRAMEWORKS_DIR}\"\n                  \
        \          \n                            for FRAMEWORK in \"${EMBED_FRAMEWORKS[@]}\"\
        ; do\n                                # Remove the BUILT_PRODUCTS_DIR prefix\
        \ to get only the framework name and subpath\n                           \
        \     FRAMEWORK_NAME=$(basename \"${FRAMEWORK}\")\n                      \
        \          echo \"Framework Name: ${FRAMEWORK_NAME}\"\n                  \
        \              \n                                if [ -d \"${FRAMEWORK}\"\
        \ ]; then\n                                echo \"Embedding ${FRAMEWORK}\"\
        \n                                rsync -av --delete \"${FRAMEWORK}\" \"${FRAMEWORKS_DIR}\"\
        \n\n                                # Set permissions to edit framework\n\
        \                                chmod -R u+w \"${FRAMEWORKS_DIR}/${FRAMEWORK_NAME}\"\
        \n\n                                # Code-sign the framework for device compatibility\n\
        \                                echo \"Code-signing ${FRAMEWORK}\"\n    \
        \                            echo \"Code signing identity: ${EXPANDED_CODE_SIGN_IDENTITY}\"\
        \n                                /usr/bin/codesign --force --deep --sign\
        \ \"${EXPANDED_CODE_SIGN_IDENTITY}\" --preserve-metadata=identifier,entitlements\
        \ \"${FRAMEWORKS_DIR}/${FRAMEWORK_NAME}\"\n                              \
        \  fi\n                            done\n                        "
packages:
  web3swift:
    url: https://github.com/web3swift-team/web3swift.git
    minorVersion: 3.2.0
  CryptoSwift:
    url: https://github.com/krzyzanowskim/CryptoSwift.git
    minorVersion: 1.5.1
  url-image:
    url: https://github.com/dmytro-anokhin/url-image.git
    minorVersion: 3.0.0
  SkeletonUI:
    url: https://github.com/CSolanaM/SkeletonUI.git
    minorVersion: 2.0.1
  SwiftyRSA:
    url: https://github.com/TakeScoop/SwiftyRSA.git
    minorVersion: 1.8.0
  adyen-ios:
    url: https://github.com/Adyen/adyen-ios.git
    exactVersion: 5.12.0
  ActivityIndicatorView:
    url: https://github.com/exyte/ActivityIndicatorView.git
    minorVersion: 1.1.0
  DeviceKit:
    url: https://github.com/devicekit/DeviceKit.git
    minorVersion: 4.0.0
